#!/usr/bin/env bash

source "${BASH_SOURCE%/*}/shared.sh"

require_installer package-manager

install_go() {
  if ! which go > /dev/null 2>&1; then
    if [ ! -d ~/go ]; then
      mkdir ~/go
    fi

    if [ ! -d ~/go/src/github.com/user ]; then
      mkdir -p ~/go/src/github.com/user
    fi

    export GOPATH=$HOME/go
    export GOROOT=/usr/local/opt/go/libexec
    export PATH=$PATH:$GOPATH/bin
    export PATH=$PATH:$GOROOT/bin

    brew_install go
  else
    log_package_not_needed "go"
  fi
}

install_go_packages() {
  if ! which go > /dev/null 2>&1; then
    install_go
  fi

  log_install_package "goimports"
  go get -u golang.org/x/tools/cmd/goimports

  log_install_package "gocode"
  go get -u github.com/nsf/gocode

  log_install_package "guru"
  go get -u golang.org/x/tools/cmd/guru
}

install_go
install_go_packages
